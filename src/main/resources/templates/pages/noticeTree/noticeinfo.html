<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>公告管理</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/layui/2.4.5/css/layui.css}"/>
    <script th:src="@{/webjars/jquery/3.3.1/jquery.js}" type="text/javascript"></script>
    <script th:src="@{/webjars/layui/2.4.5/layui.js}" type="text/javascript"></script>
    <style type="text/css">
        *{
            margin: 0px;
            padding: 0px;
        }


    </style>
</head>
<body>


<table class="layui-table" id="list" lay-filter="list"  lay-even="" lay-skin="row" style="margin:0px 0px;"></table>

<!--<div id="page1"></div>-->


<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
        <!--<button class="layui-btn layui-btn-sm" lay-event="delete">删除</button>-->
    </div>
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
</script>


<script th:inline="none">


    layui.use(['laydate','form', 'table','element','laypage'], function () {

        var laydate = layui.laydate;
        var form = layui.form;
        var table = layui.table;

        var element = layui.element;

        form.render();
        element.init();

        // 分页功能
        var laypage = layui.laypage;
        var url = "selectNoticeinfoALL";
        var config = {page:1,limit:3};
        $.getJSON(url,config,function(res){
            laypage.render({
                elem: 'page1',
                count: res.count, //总条数
                limit:config.limit, //每页条数
                layout: ['count', 'prev', 'page', 'next', 'skip'],
                theme: '#FFB800', //自定义颜色
                jump: function(obj, first){
                    if(!first){ //首次则不进入
                        config.page = obj.curr;
                        getNoticeListByPage(url,config);
                    }
                }
            });
            parseNoticeList(res.data.list,config.page);

        });

        //点击页数从后台获取数据
        function getNoticeListByPage(url,config){
            $.getJSON(url,config,function(res){
                parseNoticeList(res.data.list,config.page);
            });

        }

        //解析数据，currPage参数为预留参数，当删除一行刷新列表时，可以记住当前页而不至于显示到首页去
        function parseNoticeList(res,currPage){
            table.render({
                elem: '#list',
                data: res,//数据接口,
                page: true,
                title: '公告信息',
                toolbar: '#toolbarDemo',
                cols: [[ //表头
                    // {type:'checkbox', fixed: 'left'},
                    {field:'nId', title: '公告编号',width:'100', sort: true, fixed: 'left',style:'height:20px;',align:'center'},
                    {field:'userid', title: '职工编号（发布人）',width:'100',style:'vertical-align: middle',align:'center'},
                    {field:'nTitle', title: '公告标题',width:'100',templet: '#type',align:'center'},
                    {field:'nTime', title: '发布时间',width:'100',align:'center'},
                    {field:'nContent', title:'公告内容',width:'200',align:'center',templet:'#amount'},
                    {title: '操作', align:'center',width:'180', toolbar: '#barDemo'}
                ]]
            });



            //监听行工具事件
            table.on('tool(list)', function(obj){
                var data = obj.data;
                //console.log(obj)
                if(obj.event === 'del'){
                    layer.confirm('真的删除行么', function(index){
                        obj.del();
                        layer.close(index);
                    });
                } else if(obj.event === 'edit'){
                    layer.prompt({
                        formType: 2
                        ,value: data.userid
                    }, function(value, index){
                        obj.update({
                            email: value
                        });
                        layer.close(index);
                    });
                }
            });


            table.on('toolbar(list)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){
                    case 'add':
                        layer.msg('添加');
                        break;
                    case 'delete':
                        layer.msg('删除');
                        break;
                };
            });

        }

    });
</script>
</body>
</html>