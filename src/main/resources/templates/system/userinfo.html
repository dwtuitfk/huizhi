<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>layui</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/layui/2.4.5/css/layui.css}"/>
    <script th:src="@{/webjars/jquery/3.3.1/jquery.js}" type="text/javascript"></script>
    <script th:src="@{/webjars/layui/2.4.5/layui.js}" type="text/javascript"></script>
    <style type="text/css">
        *{
            margin: 0px;
            padding: 0px;
        }

    </style>
</head>
<body>


<table class="layui-table" id="list" lay-filter="list"  lay-even="" lay-skin="row"></table>
<div id="page1"></div>


<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>

        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
        <button class="layui-btn layui-btn-sm" lay-event="delete">删除</button>
        <button class="layui-btn layui-btn-sm" lay-event="update">编辑</button>
    </div>
</script>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>

</script>


<script type="text/html" id="barDemo2">

    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script th:inline="none">


    layui.use(['laydate','form', 'table','element','laypage'], function () {

        var laydate = layui.laydate;
        var form = layui.form;
        var table = layui.table;

        var element = layui.element;

        form.render();
        element.init();

        // 分页功能
        var laypage = layui.laypage;
        var url = "userinfopage";
        var config = {page:1,limit:10};
        $.getJSON(url,config,function(res){
            laypage.render({
                elem: 'page1',
                count: res.count, //总条数
                limit:config.limit, //每页条数
                layout: ['count', 'prev', 'page', 'next', 'skip'],
                theme: '#FFB800', //自定义颜色
                jump: function(obj, first){
                    if(!first){ //首次则不进入
                        config.page = obj.curr;
                        getUserListByPage(url,config);
                    }
                }
            });
            parseUserList(res.data.list,config.page);

        });

        //点击页数从后台获取数据
        function getUserListByPage(url,config){
            $.getJSON(url,config,function(res){
                parseUserList(res.data.list,config.page);
            });

        }

        //解析数据，currPage参数为预留参数，当删除一行刷新列表时，可以记住当前页而不至于显示到首页去
        function parseUserList(res,currPage){
            table.render({
                elem: '#list',
                data: res,//数据接口,
                page: true,
                title: '用户信息',
                toolbar: '#toolbarDemo',
                cols: [[ //表头
                    {type:'checkbox', fixed: 'left'},
                    {field:'userid', title: '职员编号',width:'100', sort: true, fixed: 'left',style:'height:20px;',align:'center'},
                    {field:'turename', title: '姓名',width:'100',style:'vertical-align: middle',align:'center'},
                    {field:'age', title: '年龄',width:'100',templet: '#type',align:'center'},
                    {field:'sex', title: '性别',width:'100',align:'center'},
                    {field:'address', title:'地址',width:'150',align:'center',templet:'#amount'},
                    {field:'email', title: '邮箱',width:'150',align:'center'},
                    {field:'phone', title: '电话',width:'150',align:'center'},
                    {title: '操作', align:'center',width:'80', toolbar: '#barDemo'},
                    {title: '操作', align:'center',width:'80', toolbar: '#barDemo2'}
                ]]
            });


            //头工具栏事件
            table.on('toolbar(list)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){
                    case 'getCheckData':
                        var data = checkStatus.data;
                        layer.alert(JSON.stringify(data));
                        break;
                    case 'getCheckLength':
                        var data = checkStatus.data;
                        layer.msg('选中了：'+ data.length + ' 个');
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选': '未全选');
                        break;
                };
            });

            //监听行工具事件
            table.on('tool(list)', function(obj){
                var data = obj.data;
                //console.log(obj)
                if(obj.event === 'del'){
                    layer.confirm('真的删除行么', function(index){
                        obj.del();
                        layer.close(index);
                    });
                } else if(obj.event === 'edit'){
                    layer.prompt({
                        formType: 2
                        ,value: data.email
                    }, function(value, index){
                        obj.update({
                            email: value
                        });
                        layer.close(index);
                    });
                }
            });

            /*
                    //监听事件
                        table.on('toolbar(list)', function(obj){
                            var checkStatus = table.checkStatus(obj.config.id);
                            switch(obj.event){
                                case 'add':
                                    layer.msg('添加');
                                    break;
                                case 'delete':
                                    layer.msg('删除');
                                    break;
                                case 'update':
                                    layer.msg('编辑');
                                    break;
                            };
                        });
            */

        }

    });
</script>
</body>
</html>